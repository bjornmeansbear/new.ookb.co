(function(window,$){"use strict"; if(!window.PBS){window.PBS={};} 
PBS.jwGoonhilly=(function(){var vidId,vidTitle,vidProgram,vidProducer,trackingId,playerType,component,id=$.cookie('pbs_si')?PBS.Profile.clientId.get():PBS.Helper.getLocalId(),sessionId=PBS.Helper.getSessionId(); function setVideoData(params){vidId=params.id;vidTitle=params.title;vidProgram=params.program;vidProducer=params.producer;playerType=params.playerType;trackingId=PBS.Helper.guid();switch(playerType){case'viral':component='Video - Viral Player';break;case'partner':component='Video - Partner Player';break;default:component='Video - Portal';break;}} 
function logGoonHilly(severity,message,eventType,eventTime,extraParams){var data,logFrame,key;data={"component":component,"severity":severity,"event_type":eventType,"x_useragent":navigator.userAgent,"x_tracking_id":trackingId,"x_producer":vidProducer,"x_tpmid":vidId,"x_episode_title":vidTitle,"x_program_title":vidProgram,"x_client_id":id,"x_session_id":sessionId,"x_video_location":parseInt(eventTime,10),"message":message};for(key in extraParams){if(Object.prototype.hasOwnProperty.call(extraParams,key)){data[key]=extraParams[key];}}
logFrame=document.createElement('iframe');logFrame.style.display='none';logFrame.src="http://log.pbs.org/log/cove-jwplayer/?"+$.param(data);$(logFrame).on('load',function(){document.body.removeChild(logFrame);});document.body.appendChild(logFrame);}
function getTrackingId(){return trackingId;}
return{setVideoData:setVideoData,logGoonHilly:logGoonHilly,getTrackingId:getTrackingId};}());}(window,jQuery));(function($){$.fn.chapterCarousel=function(params){var $carusel=$(this),$controls=$carusel.find('.controls').find('a'),$left=$carusel.find('a.leftArrow').hide(),$right=$carusel.find('a.rightArrow'),items=$carusel.find('.item'),i,options={noOfItems:2}; for(i in params){if(options.hasOwnProperty(i)){options[i]=params[i];}else{throw new Error("ChapterCarousel doesn't support option: "+i);}} 
if(items.length<=options.noOfItems){$right.hide();}
items.slice(0,options.noOfItems).addClass('active'); $('a',items).on('click',function(e){e.preventDefault(); $carusel.find('a.selected').removeClass('selected');$(this).addClass('selected');var $chapterTitleIndex=$carusel.parent().find('.chapter-no');var $description=$carusel.parent().find('.embed-description');var chapterNo;if($chapterTitleIndex){chapterNo=$(this).data('chapter');$chapterTitleIndex.html(chapterNo);}
if($description){var duration=$(this).data('duration');$description.find('.duration').html('('+duration+')');}});function showNext(direction){var actives=$carusel.find('.active'),nextItems,nextToShow;nextItems=(direction>0)?actives.slice(-1).nextAll():$(actives[0]).prevAll();nextItems=nextItems.slice(0,options.noOfItems);actives.removeClass('active');nextItems.addClass('active');nextToShow=(direction>0)?nextItems.slice(-1).nextAll():nextItems.slice(-1).prevAll();nextToShow=nextToShow.slice(0,options.noOfItems);if(nextToShow.length===0){if(direction===1){$right.hide();}else{$left.hide();}}}
$.fn.chapterCarousel.destroy=function(){$carusel.remove();$('a',items).unbind('click');};$controls.on('click',function(e){e.preventDefault();if($(this).hasClass('rightArrow')){$left.show();showNext(1);}else{$right.show();showNext(-1);}});};}(jQuery));'use strict';$.fn.modalPlayBack=function(){var modalWindow=$(this),modalOverlay=$(this).parent(),errorDescription=$(this).find('#errorDescription'),errorSubmitted=$(this).find('#errorSubmitted'),cancelButton=$(this).find('.cancelBtn'),submitButton=$(this).find('.submitBtn'),modalCloseBtn=$(this).find('.closeBtn'),heightOffset=0,scrollX,scrollY,localId=PBS.Helper.getLocalId(),sessionId=PBS.Helper.getSessionId(),selectField=$(this).find('#typeOfError'),condTextBox=$(this).find('.condTextBox'),condTextField=condTextBox.find('textarea'),footnote=$(this).find('p.footnote'),ctrlDown=false,videoTitle,videoId; if(is_ios){heightOffset=60;}
modalWindow.addClass('initiated'); function closeWindow(){modalOverlay.addClass('none');var video=$('video')[0];if(is_ios&&video){video.removeAttribute('style');}
$('body, #page').removeAttr('style'); $('#adFix, #iab').show(); window.scrollTo(scrollX,scrollY);}
function scrollFix(){var windowHeight=$(window).height();$('body, #page').css({'height':windowHeight+heightOffset,'overflow':'hidden'});} 
function showPanel(panel){switch(panel){case'description':errorDescription.show();errorSubmitted.hide();break;case'submit':errorDescription.hide();errorSubmitted.show();break;default:errorDescription.show();errorSubmitted.hide();break;}
scrollFix();var video=$('video')[0];if(is_ios&&video){video.setAttribute('style','visibility:hidden;');}} 
function submitForm(){var params={errorType:selectField.val(),videoId:videoId,videoTitle:videoTitle,isWrapped:is_wrapped,x_client_id:localId,x_session_id:sessionId,x_tracking_id:PBS.jwGoonhilly.getTrackingId(),};if(condTextField.val()){params.errorDetails=condTextField.val();}
showPanel('submit');$.ajax({url:'/feedback/submit/',type:'post',data:params,error:function(data){console.error(data);}});} 
function triggerTextField(evt){var selectedIndex=evt.currentTarget.selectedIndex,currentOption=evt.currentTarget[selectedIndex];if(currentOption.className==="trigger"){condTextBox.show();footnote.addClass('hideOnDevice');}else{condTextBox.hide();condTextField.val('');footnote.removeClass('hideOnDevice');}}
function limitText(e){var text=$(this).val(),textLen=text.length,ctrlKey=17,vKey=86,cKey=67;if(textLen>=180){ var $this=$(this);setTimeout(function(){$this.val(text.substr(0,180));},5);} 
if(e.keyCode==ctrlKey){ctrlDown=true;}
if(ctrlDown&&(e.keyCode==vKey||e.keyCode==cKey)){return false;}}
function trimPastedText(){var $this=$(this);setTimeout(function(){var text=$this.val(),textLen=text.length;if(textLen>180){$this.val(text.substr(0,180));}},5);} 
$.fn.modalPlayBack.show=function(){ scrollX=window.pageXOffset;scrollY=window.pageYOffset;modalOverlay.removeClass('none');showPanel('description'); $('#adFix, #iab').hide();};$.fn.modalPlayBack.getData=function(obj){videoId=obj.id;videoTitle=obj.title;}; modalCloseBtn.on('click',closeWindow);cancelButton.on('click',closeWindow);submitButton.on('click',submitForm);selectField.on('change',function(evt){triggerTextField(evt);});condTextField.on('keypress',limitText);condTextField.on('paste',trimPastedText);$(window).on('orientationchange',function(){if(modalWindow.is(':visible')){scrollFix();}});};